<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ğŸšª Door Control Realtime</title>
        <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
        <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: linear-gradient(to bottom right, #eef6ff, #cbe1ff);
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      h1 {
        color: #004aad;
      }
      .status {
        font-size: 1.5em;
        margin: 15px;
        color: #333;
      }
      button {
        font-size: 1.2em;
        padding: 10px 20px;
        margin: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .lock {
        background: #e74c3c;
        color: white;
      }
      .unlock {
        background: #2ecc71;
        color: white;
      }
      button:hover {
        opacity: 0.8;
        transform: scale(1.05);
      }
    </style>
    </head>
    <body>
        <h1>ğŸ” Door Lock Realtime</h1>
        <div class="status">
            Tráº¡ng thÃ¡i cá»­a: <b id="door-status">Äang káº¿t ná»‘i...</b>
        </div>
        <div>
            <button class="lock" id="btn-lock">ğŸ”’ KhoÃ¡ cá»­a</button>
            <button class="unlock" id="btn-unlock">ğŸ”“ Má»Ÿ cá»­a</button>
        </div>

        <script>
      // ğŸ”§ Äá»•i IP nÃ y thÃ nh IP mÃ¡y cháº¡y Mosquitto (vd 192.168.1.8)
      ip='192.168.1.8'
      const brokerUrl = `ws://${ip}:9001/mqtt`;
      const topicStatus = "demo/door/status";
      const topicCommand = "demo/door/command";

      const statusEl = document.getElementById("door-status");
      const lockBtn = document.getElementById("btn-lock");
      const unlockBtn = document.getElementById("btn-unlock");

      // Káº¿t ná»‘i tá»›i broker
      const client = mqtt.connect(brokerUrl);

      client.on("connect", () => {
        console.log("âœ… ÄÃ£ káº¿t ná»‘i MQTT");
        statusEl.textContent = "ğŸŸ¢ ÄÃ£ káº¿t ná»‘i MQTT";
        client.subscribe(topicStatus);
      });

      client.on("message", (topic, payload) => {
        if (topic !== topicStatus) return;
        const msg = payload.toString();
        console.log("ğŸ“© MQTT:", msg);

        if (msg === "LOCKED") {
          statusEl.textContent = "ğŸ”’ Cá»­a Ä‘ang ÄÃ“NG";
          statusEl.style.color = "red";
        } else if (msg === "UNLOCKED") {
          statusEl.textContent = "ğŸ”“ Cá»­a Ä‘ang Má»";
          statusEl.style.color = "green";
        } else if (msg === "WRONG_PASSWORD") {
          statusEl.textContent = "âš ï¸ Sai máº­t kháº©u!";
          statusEl.style.color = "orange";
        } else if (msg === "INTRUSION_ALERT") {
          statusEl.textContent = "ğŸš¨ BÃ¡o Ä‘á»™ng!";
          statusEl.style.color = "crimson";
        } else {
          statusEl.textContent = msg;
          statusEl.style.color = "#333";
        }
      });

      client.on("error", (err) => {
        console.error("âŒ MQTT error:", err);
        statusEl.textContent = "Lá»—i MQTT â€“ kiá»ƒm tra brokerUrl";
        statusEl.style.color = "gray";
      });

      // Gá»­i lá»‡nh tá»« web
      lockBtn.onclick = () => {
        client.publish(topicCommand, "LOCK");
        console.log("ğŸ”’ gá»­i lá»‡nh LOCK");
      };

      unlockBtn.onclick = () => {
        client.publish(topicCommand, "UNLOCK");
        console.log("ğŸ”“ gá»­i lá»‡nh UNLOCK");
      };
    </script>
    </body>
</html>
